var GLDSpringManager=function(){this.init()};GLDSpringManager.prototype.init=function(){this.nodes=[];this.springs=[];this.wind=0;this.gravity=0.1;this.minX=0;this.maxX=640;this.minY=0;this.maxY=480};GLDSpringManager.prototype.createNode=function(a,d,b,c){return this.addNode(new GLDSpringNode(a,d,b,c))};GLDSpringManager.prototype.addNode=function(a){this.nodes.push(a);return a};GLDSpringManager.prototype.addNodes=function(a){var c=a.length;for(var b=0;b<c;b++){this.addNode(a[b])}return a};GLDSpringManager.prototype.removeNode=function(c){var d=this.nodes.length;for(var a=0;a<d;a++){var b=this.nodes[a];if(c==b){this.nodes.splice(a,1);return true}}return false};GLDSpringManager.prototype.createSpring=function(c,b,a,d){return this.addSpring(new GLDSpring(c,b,a,d))};GLDSpringManager.prototype.addSpring=function(a){this.springs.push(a);return a};GLDSpringManager.prototype.addSprings=function(a){var c=a.length;for(var b=0;b<c;b++){this.addSpring(a[b])}return a};GLDSpringManager.prototype.removeSpring=function(c){var d=this.springs.length;for(var a=0;a<d;a++){var b=this.springs[a];if(c==b){this.springs.splice(a,1);return true}}return false};GLDSpringManager.prototype.update=function(){this._updateForce();this._updateVelocity();this._updatePosition();this._updateConstraint();this._resetForce()};GLDSpringManager.prototype.nearestNode=function(f,e){var g=Number.POSITIVE_INFINITY;var b;var a=this.nodes.length;for(var d=0;d<a;d++){var c=this.nodes[d];var k=c.x-f;var j=c.y-e;var h=k*k+j*j;if(h<g){g=h;b=c}}return b};GLDSpringManager.prototype.connectedNodes=function(c){var a=[];var e=this.springs.length;for(var b=0;b<e;b++){var d=this.springs[b];if(d.node0==c&&d.node1){a.push(d.node1)}if(d.node1==c&&d.node0){a.push(d.node0)}}return a};GLDSpringManager.prototype.connectedSprings=function(c){var a=[];var e=this.springs.length;for(var b=0;b<e;b++){var d=this.springs[b];if(d.node0==c&&d.node1){a.push(d)}if(d.node1==c&&d.node0){a.push(d)}}return a};GLDSpringManager.prototype.onTouchLeftBoundary=function(a){};GLDSpringManager.prototype.onTouchRightBoundary=function(a){};GLDSpringManager.prototype.onTouchTopBoundary=function(a){};GLDSpringManager.prototype.onTouchBottomBoundary=function(a){};GLDSpringManager.prototype._resetForce=function(){var b=this.nodes.length;for(var a=0;a<b;a++){this.nodes[a]._resetForce()}};GLDSpringManager.prototype._updateForce=function(){var b=this.nodes.length;for(var a=0;a<b;a++){this.nodes[a].applyForce(this.wind,this.gravity);this.nodes[a].applyForce(Math.random()*0.001-0.0005,Math.random()*0.001-0.0005)}b=this.springs.length;for(var a=0;a<b;a++){this.springs[a].update()}};GLDSpringManager.prototype._updateVelocity=function(){var b=this.nodes.length;for(var a=0;a<b;a++){this.nodes[a]._updateVelocity()}};GLDSpringManager.prototype._updatePosition=function(){var b=this.nodes.length;for(var a=0;a<b;a++){this.nodes[a]._updatePosition()}};GLDSpringManager.prototype._updateConstraint=function(){var c=this.nodes.length;for(var a=0;a<c;a++){var b=this.nodes[a];if(b.x<this.minX){b.x=this.minX;b.vx=Math.abs(b.vx);this.onTouchLeftBoundary(b)}else{if(b.x>this.maxX){b.x=this.maxX;b.vx=-Math.abs(b.vx);this.onTouchRightBoundary(b)}}if(b.y<this.minY){b.y=this.minY;b.vy=Math.abs(b.vy)*0.5;b.vx*=0.001}else{if(b.y>this.maxY){b.y=this.maxY;b.vy=-Math.abs(b.vy)*0.5;b.vx*=0.001}}}};var GLDSpringNode=function(a,d,b,c){this.init(a,d,b,c)};GLDSpringNode.prototype.init=function(a,e,c,d){this.x=a||0;this.y=e||0;this.isFixed=c||false;this.fx=0;this.fy=0;this.vx=0;this.vy=0;this.mass=1;this.maxVelocity=999;this.deccel=0.99;if(d){for(var b in d){this[b]=d[b]}}};GLDSpringNode.prototype.applyForce=function(b,a){this.fx+=b;this.fy+=a};GLDSpringNode.prototype.velocity=function(){return this.vx*this.vx+this.vy*this.vy};GLDSpringNode.prototype._resetForce=function(){this.fx=0;this.fy=0};GLDSpringNode.prototype._updateVelocity=function(){this.vx=(this.vx+this.fx/this.mass)*this.deccel;this.vy=(this.vy+this.fy/this.mass)*this.deccel};GLDSpringNode.prototype._updatePosition=function(){if(!this.isFixed){this.x+=this.vx;this.y+=this.vy}};var GLDSpring=function(c,b,a,d){this.init(c,b,a,d)};GLDSpring.prototype.init=function(d,c,b,e){this.node0=d;this.node1=c;this.fixedLength=b|this.distance();this.k=0.01;this.enabled=true;this.amplitude=0;this.period=0;this.shift=0;this.switchback=false;if(e){for(var a in e){this[a]=e[a]}}};GLDSpring.prototype.update=function(){var c;if(this.period>0){this.shift=(this.switchback)?this.shift-1:this.shift+1;this.shift=this.shift%this.period;var a=Math.sin(this.shift/this.period*2*Math.PI);c=this.fixedLength+Math.sin(a)*this.amplitude}else{c=this.fixedLength}var g=0;var e=0;var d=this.node1.x-this.node0.x;var b=this.node1.y-this.node0.y;var i=Math.sqrt(d*d+b*b);if(i>1){var h=i-c;g=d/i*h*this.k;e=b/i*h*this.k}this.node0.applyForce(g,e);this.node1.applyForce(-g,-e)};GLDSpring.prototype.distance=function(){var b=this.node1.x-this.node0.x;var a=this.node1.y-this.node0.y;return Math.sqrt(b*b+a*a)};var GLDRepulsion=function(d,c,b,e){this.node0=d;this.node1=c;this.fixedLength=b|this.distance();this.power=10;this.k=0.01;this.enabled=true;if(e){for(var a in e){this[a]=e[a]}}};GLDRepulsion.prototype.update=function(){var d=0;var c=0;var b=this.node1.x-this.node0.x;var a=this.node1.y-this.node0.y;var g=Math.sqrt(b*b+a*a);if(g>1){var e=g-l;d=b/g/g/g*this.power;c=a/g/g/g*this.power}this.node0.applyForce(d,c);this.node1.applyForce(-d,-c)};GLDRepulsion.prototype.distance=function(){var b=this.node1.x-this.node0.x;var a=this.node1.y-this.node0.y;return Math.sqrt(b*b+a*a)};